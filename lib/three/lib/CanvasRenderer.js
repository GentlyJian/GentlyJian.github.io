THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){function t(){xe.setRGB(0,0,0),ue.setRGB(0,0,0),ye.setRGB(0,0,0);for(var e=0,t=g.length;e<t;e++){var i=g[e],n=i.color;i instanceof THREE.AmbientLight?xe.add(n):i instanceof THREE.DirectionalLight?ue.add(n):i instanceof THREE.PointLight&&ye.add(n)}}function i(e,t,i){for(var n=0,o=g.length;n<o;n++){var r=g[n];if(fe.copy(r.color),r instanceof THREE.DirectionalLight){var a=Re.setFromMatrixPosition(r.matrixWorld).normalize(),s=t.dot(a);if(s<=0)continue;s*=r.intensity,i.add(fe.multiplyScalar(s))}else if(r instanceof THREE.PointLight){var a=Re.setFromMatrixPosition(r.matrixWorld),s=t.dot(Re.subVectors(a,e).normalize());if(s<=0)continue;if(0==(s*=0==r.distance?1:1-Math.min(e.distanceTo(a)/r.distance,1)))continue;s*=r.intensity,i.add(fe.multiplyScalar(s))}}}function n(e,t,i){f(i.opacity),d(i.blending);var n=t.scale.x*q,o=t.scale.y*J,r=.5*Math.sqrt(n*n+o*o);if(ve.min.set(e.x-r,e.y-r),ve.max.set(e.x+r,e.y+r),i instanceof THREE.SpriteMaterial){var a=i.map;if(null!==a){var s=de[a.id];if(void 0!==s&&s.version===a.version||(s=c(a),de[a.id]=s),void 0!==s.canvas){u(s.canvas);var l=a.image,p=l.width*a.offset.x,E=l.height*a.offset.y,h=l.width*a.repeat.x,m=l.height*a.repeat.y,v=n/h,y=o/m;$.save(),$.translate(e.x,e.y),0!==i.rotation&&$.rotate(i.rotation),$.translate(-n/2,-o/2),$.scale(v,y),$.translate(-p,-E),$.fillRect(p,E,h,m),$.restore()}}else u(i.color.getStyle()),$.save(),$.translate(e.x,e.y),0!==i.rotation&&$.rotate(i.rotation),$.scale(n,-o),$.fillRect(-.5,-.5,1,1),$.restore()}else i instanceof THREE.SpriteCanvasMaterial&&(x(i.color.getStyle()),u(i.color.getStyle()),$.save(),$.translate(e.x,e.y),0!==i.rotation&&$.rotate(i.rotation),$.scale(n,o),i.program($),$.restore())}function o(e,t,i,n){if(f(n.opacity),d(n.blending),$.beginPath(),$.moveTo(e.positionScreen.x,e.positionScreen.y),$.lineTo(t.positionScreen.x,t.positionScreen.y),n instanceof THREE.LineBasicMaterial){if(h(n.linewidth),m(n.linecap),v(n.linejoin),n.vertexColors!==THREE.VertexColors)x(n.color.getStyle());else{var o=i.vertexColors[0].getStyle(),r=i.vertexColors[1].getStyle();if(o===r)x(o);else{try{var a=$.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,o),a.addColorStop(1,r)}catch(e){a=o}x(a)}}$.stroke(),ve.expandByScalar(2*n.linewidth)}else n instanceof THREE.LineDashedMaterial&&(h(n.linewidth),m(n.linecap),v(n.linejoin),x(n.color.getStyle()),y([n.dashSize,n.gapSize]),$.stroke(),ve.expandByScalar(2*n.linewidth),y([]))}function r(e,t,n,o,r,c,E,h){if(O.info.render.vertices+=3,O.info.render.faces++,f(h.opacity),d(h.blending),M=e.positionScreen.x,b=e.positionScreen.y,L=t.positionScreen.x,B=t.positionScreen.y,P=n.positionScreen.x,V=n.positionScreen.y,a(M,b,L,B,P,V),(h instanceof THREE.MeshLambertMaterial||h instanceof THREE.MeshPhongMaterial)&&null===h.map)pe.copy(h.color),Ee.copy(h.emissive),h.vertexColors===THREE.FaceColors&&pe.multiply(E.color),ce.copy(xe),Te.copy(e.positionWorld).add(t.positionWorld).add(n.positionWorld).divideScalar(3),i(Te,E.normalModel,ce),ce.multiply(pe).add(Ee),!0===h.wireframe?s(ce,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):l(ce);else if(h instanceof THREE.MeshBasicMaterial||h instanceof THREE.MeshLambertMaterial||h instanceof THREE.MeshPhongMaterial)if(null!==h.map){var m=h.map.mapping;m===THREE.UVMapping&&(W=E.uvs,p(M,b,L,B,P,V,W[o].x,W[o].y,W[r].x,W[r].y,W[c].x,W[c].y,h.map))}else null!==h.envMap?h.envMap.mapping===THREE.SphericalReflectionMapping&&(ge.copy(E.vertexNormalsModel[o]).applyMatrix3(Se),z=.5*ge.x+.5,j=.5*ge.y+.5,ge.copy(E.vertexNormalsModel[r]).applyMatrix3(Se),k=.5*ge.x+.5,D=.5*ge.y+.5,ge.copy(E.vertexNormalsModel[c]).applyMatrix3(Se),F=.5*ge.x+.5,N=.5*ge.y+.5,p(M,b,L,B,P,V,z,j,k,D,F,N,h.envMap)):(ce.copy(h.color),h.vertexColors===THREE.FaceColors&&ce.multiply(E.color),!0===h.wireframe?s(ce,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):l(ce));else h instanceof THREE.MeshNormalMaterial?(ge.copy(E.normalModel).applyMatrix3(Se),ce.setRGB(ge.x,ge.y,ge.z).multiplyScalar(.5).addScalar(.5),!0===h.wireframe?s(ce,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):l(ce)):(ce.setRGB(1,1,1),!0===h.wireframe?s(ce,h.wireframeLinewidth,h.wireframeLinecap,h.wireframeLinejoin):l(ce))}function a(e,t,i,n,o,r){$.beginPath(),$.moveTo(e,t),$.lineTo(i,n),$.lineTo(o,r),$.closePath()}function s(e,t,i,n){h(t),m(i),v(n),x(e.getStyle()),$.stroke(),ve.expandByScalar(2*t)}function l(e){u(e.getStyle()),$.fill()}function c(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var t=e.image;if(!1===t.complete)return{canvas:void 0,version:0};var i=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping,n=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping,o=e.wrapS===THREE.MirroredRepeatWrapping,r=e.wrapT===THREE.MirroredRepeatWrapping,a=document.createElement("canvas");a.width=t.width*(o?2:1),a.height=t.height*(r?2:1);var s=a.getContext("2d");s.setTransform(1,0,0,-1,0,t.height),s.drawImage(t,0,0),!0===o&&(s.setTransform(-1,0,0,-1,t.width,t.height),s.drawImage(t,-t.width,0)),!0===r&&(s.setTransform(1,0,0,1,0,0),s.drawImage(t,0,t.height)),!0===o&&!0===r&&(s.setTransform(-1,0,0,1,t.width,0),s.drawImage(t,-t.width,t.height));var l="no-repeat";!0===i&&!0===n?l="repeat":!0===i?l="repeat-x":!0===n&&(l="repeat-y");var c=$.createPattern(a,l);return e.onUpdate&&e.onUpdate(e),{canvas:c,version:e.version}}function p(e,t,i,n,o,r,a,s,l,p,E,f,d){var h=de[d.id];if(void 0!==h&&h.version===d.version||(h=c(d),de[d.id]=h),void 0===h.canvas)return u("rgba( 0, 0, 0, 1)"),void $.fill();u(h.canvas);var m,v,x,y,R,T,g,S,w=d.offset.x/d.repeat.x,H=d.offset.y/d.repeat.y,C=d.image.width*d.repeat.x,M=d.image.height*d.repeat.y;a=(a+w)*C,s=(s+H)*M,l=(l+w)*C,p=(p+H)*M,E=(E+w)*C,f=(f+H)*M,i-=e,n-=t,o-=e,r-=t,l-=a,p-=s,E-=a,f-=s,0!==(g=l*f-E*p)&&(S=1/g,m=(f*i-p*o)*S,v=(f*n-p*r)*S,x=(l*o-E*i)*S,y=(l*r-E*n)*S,R=e-m*a-x*s,T=t-v*a-y*s,$.save(),$.transform(m,v,x,y,R,T),$.fill(),$.restore())}function E(e,t,i){var n,o=t.x-e.x,r=t.y-e.y,a=o*o+r*r;0!==a&&(n=i/Math.sqrt(a),o*=n,r*=n,t.x+=o,t.y+=r,e.x-=o,e.y-=r)}function f(e){te!==e&&($.globalAlpha=e,te=e)}function d(e){ie!==e&&(e===THREE.NormalBlending?$.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?$.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending?$.globalCompositeOperation="darker":e===THREE.MultiplyBlending&&($.globalCompositeOperation="multiply"),ie=e)}function h(e){re!==e&&($.lineWidth=e,re=e)}function m(e){ae!==e&&($.lineCap=e,ae=e)}function v(e){se!==e&&($.lineJoin=e,se=e)}function x(e){ne!==e&&($.strokeStyle=e,ne=e)}function u(e){oe!==e&&($.fillStyle=e,oe=e)}function y(e){le.length!==e.length&&($.setLineDash(e),le=e)}console.log("THREE.CanvasRenderer",THREE.REVISION),e=e||{};var R,T,g,S,w,H,C,M,b,L,B,P,V,W,z,j,k,D,F,N,O=this,A=new THREE.Projector,I=void 0!==e.canvas?e.canvas:document.createElement("canvas"),G=I.width,U=I.height,q=Math.floor(G/2),J=Math.floor(U/2),K=0,Q=0,X=G,Y=U,Z=1,$=I.getContext("2d",{alpha:!0===e.alpha}),_=new THREE.Color(0),ee=!0===e.alpha?0:1,te=1,ie=0,ne=null,oe=null,re=null,ae=null,se=null,le=[],ce=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),pe=(new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color),Ee=new THREE.Color,fe=new THREE.Color,de={},he=new THREE.Box2,me=new THREE.Box2,ve=new THREE.Box2,xe=new THREE.Color,ue=new THREE.Color,ye=new THREE.Color,Re=new THREE.Vector3,Te=new THREE.Vector3,ge=new THREE.Vector3,Se=new THREE.Matrix3;void 0===$.setLineDash&&($.setLineDash=function(){}),this.domElement=I,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return $},this.getContextAttributes=function(){return $.getContextAttributes()},this.getPixelRatio=function(){return Z},this.setPixelRatio=function(e){void 0!==e&&(Z=e)},this.setSize=function(e,t,i){G=e*Z,U=t*Z,I.width=G,I.height=U,q=Math.floor(G/2),J=Math.floor(U/2),!1!==i&&(I.style.width=e+"px",I.style.height=t+"px"),he.min.set(-q,-J),he.max.set(q,J),me.min.set(-q,-J),me.max.set(q,J),te=1,ie=0,ne=null,oe=null,re=null,ae=null,se=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,n){K=e*Z,Q=t*Z,X=i*Z,Y=n*Z},this.setScissor=function(){},this.setScissorTest=function(){},this.setClearColor=function(e,t){_.set(e),ee=void 0!==t?t:1,me.min.set(-q,-J),me.max.set(q,J)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return _},this.getClearAlpha=function(){return ee},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===me.isEmpty()&&(me.intersect(he),me.expandByScalar(2),me.min.x=me.min.x+q,me.min.y=-me.min.y+J,me.max.x=me.max.x+q,me.max.y=-me.max.y+J,ee<1&&$.clearRect(0|me.min.x,0|me.max.y,me.max.x-me.min.x|0,me.min.y-me.max.y|0),ee>0&&(d(THREE.NormalBlending),f(1),u("rgba("+Math.floor(255*_.r)+","+Math.floor(255*_.g)+","+Math.floor(255*_.b)+","+ee+")"),$.fillRect(0|me.min.x,0|me.max.y,me.max.x-me.min.x|0,me.min.y-me.max.y|0)),me.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,i){if(i instanceof THREE.Camera==!1)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");var a=e.background;a&&a.isColor?(u("rgb("+Math.floor(255*a.r)+","+Math.floor(255*a.g)+","+Math.floor(255*a.b)+")"),$.fillRect(0,0,G,U)):!0===this.autoClear&&this.clear(),O.info.render.vertices=0,O.info.render.faces=0,$.setTransform(X/G,0,0,-Y/U,K,U-Q),$.translate(q,J),R=A.projectScene(e,i,this.sortObjects,this.sortElements),T=R.elements,g=R.lights,S=i,Se.getNormalMatrix(i.matrixWorldInverse),t();for(var s=0,l=T.length;s<l;s++){var c=T[s],p=c.material;if(void 0!==p&&0!==p.opacity){if(ve.makeEmpty(),c instanceof THREE.RenderableSprite)w=c,w.x*=q,w.y*=J,n(w,c,p);else if(c instanceof THREE.RenderableLine)w=c.v1,H=c.v2,w.positionScreen.x*=q,w.positionScreen.y*=J,H.positionScreen.x*=q,H.positionScreen.y*=J,ve.setFromPoints([w.positionScreen,H.positionScreen]),!0===he.intersectsBox(ve)&&o(w,H,c,p);else if(c instanceof THREE.RenderableFace){if(w=c.v1,H=c.v2,C=c.v3,w.positionScreen.z<-1||w.positionScreen.z>1)continue;if(H.positionScreen.z<-1||H.positionScreen.z>1)continue;if(C.positionScreen.z<-1||C.positionScreen.z>1)continue;w.positionScreen.x*=q,w.positionScreen.y*=J,H.positionScreen.x*=q,H.positionScreen.y*=J,C.positionScreen.x*=q,C.positionScreen.y*=J,p.overdraw>0&&(E(w.positionScreen,H.positionScreen,p.overdraw),E(H.positionScreen,C.positionScreen,p.overdraw),E(C.positionScreen,w.positionScreen,p.overdraw)),ve.setFromPoints([w.positionScreen,H.positionScreen,C.positionScreen]),!0===he.intersectsBox(ve)&&r(w,H,C,0,1,2,c,p)}me.union(ve)}}$.setTransform(1,0,0,1,0,0)}};